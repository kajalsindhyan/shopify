# Shopify 3D Print Price Calculator

This is a complete, production-ready Shopify Custom App that provides an instant price calculator for custom 3D printing services. It allows customers to upload a 3D model, get a price based on its volume and selected materials, and add the custom product to their Shopify cart.

## Features

- **Storefront Calculator**: An App Embed block that can be placed on any product page.
- **File Upload**: Supports `.STL` files with a client-side size check.
- **Interactive 3D Preview**: Customers can view, rotate, and zoom their uploaded model using `three.js`.
- **Instant Price Calculation**: Prices are calculated in the browser based on model volume and material properties.
- **Shopify Cart Integration**: Adds the custom print as a product to the Shopify cart with the calculated price and a link to the 3D file as a line item property.
- **Admin Interface**: A comprehensive panel within the Shopify Admin for managing materials, including their name, density, price per gram, and base fees.
- **Localization**: All storefront text is in Norwegian and managed via a simple JSON file.

## Tech Stack

- **Frontend**: React 18, TypeScript, Tailwind CSS
- **3D Rendering**: `three.js`, `@react-three/fiber`, `@react-three/drei`
- **Shopify Integration**: Theme App Extension (App Embed Block) for the storefront, and an Admin Link for the settings page.
- **Backend**: Assumes a Node.js backend (as generated by Shopify CLI) to handle API requests. The provided code includes a mock API for frontend development.

---

## 1. Development Environment Setup

This project is structured as a modern React application. Follow these steps to get it running locally.

### Prerequisites

- [Node.js](https://nodejs.org/) (v18 or later)
- [npm](https://www.npmjs.com/) or [yarn](https://yarnpkg.com/)
- A Shopify Partner account and a development store.
- [Shopify CLI](https://shopify.dev/docs/apps/tools/cli)

### Installation

1.  **Clone the Repository**:
    Although the code is provided as individual files, you would typically start by cloning a repository. For this project, save the provided files into the directory structure specified.

2.  **Install Dependencies**:
    Navigate to your project's root directory and install the required npm packages.

    ```bash
    npm install react react-dom three @types/three @react-three/fiber @react-three/drei react-router-dom
    ```
    *   `react`, `react-dom`: Core React libraries.
    *   `three`, `@types/three`: The `three.js` library for 3D graphics.
    *   `@react-three/fiber`, `@react-three/drei`: React renderers and helpers for `three.js`, simplifying 3D scene creation.
    *   `react-router-dom`: To handle routing between the admin and storefront views in the provided demo.

3.  **Set up Environment Variables**:
    This app requires an API key for a file storage service. Create a `.env` file in the root of your project:

    ```
    # This is used by the Shopify Cart API to add a product
    # Go to your product in Shopify Admin, click '.json' in the URL, and find the variant ID.
    # e.g., https://your-store.myshopify.com/admin/products/12345.json
    REACT_APP_SHOPIFY_PRODUCT_VARIANT_ID="gid://shopify/ProductVariant/YOUR_VARIANT_ID_HERE"

    # This is a placeholder for your file storage service API key
    REACT_APP_FILESTACK_API_KEY="YOUR_FILESTACK_OR_S3_API_KEY"
    ```

    **Note**: The provided code uses a mock uploader. To use a real service, you will need to update `services/api.ts`.

---

## 2. Configuration

### File Storage Service

The app needs a place to store uploaded 3D files permanently so they can be accessed with the order.

1.  **Choose a Service**:
    - **AWS S3**: A robust and scalable option. You'll need to set up a bucket, configure public access (or signed URLs), and create an API endpoint on your backend to handle uploads.
    - **Google Cloud Storage**: Similar to S3.
    - **Filestack**: A third-party service that simplifies file uploads. It's a great option for getting started quickly.

2.  **Implement the Upload Logic**:
    - Open `services/api.ts`.
    - Find the `uploadFile` function.
    - Replace the mock implementation (which uses `setTimeout`) with a real API call to your chosen service. You will likely need to send the file to your app's backend, which then securely uploads it to the storage provider and returns the permanent URL.

### Shopify Product Setup

1.  **Create the "Custom Print" Product**:
    - In your Shopify Admin, go to **Products** and create a new product.
    - **Title**: "Custom 3D Print" (or similar).
    - **Description**: Explain that this product is for custom uploads.
    - **Pricing**: Set a default price, like `0.00 NOK`. The app will override this.
    - **Inventory**: Ensure "Track quantity" is unchecked, or set a high stock level.
    - **Save** the product.

2.  **Get the Variant ID**:
    - After saving, view the product in your Admin. The URL will look like `.../admin/products/789123456`.
    - Add `.json` to the end of the URL: `.../admin/products/789123456.json` and press Enter.
    - Search the JSON for `"variants"`. Find the `"id"` of the variant you want to use. It will look like `4567890123`.
    - Copy this number and update the `REACT_APP_SHOPIFY_PRODUCT_VARIANT_ID` in your `.env` file. The format for the AJAX API is just the number.

---

## 3. Running and Deploying the App

This app has two main parts: the admin interface and the storefront theme extension.

### Running Locally (as a Shopify App)

1.  Use the Shopify CLI to serve your app:
    ```bash
    shopify app dev
    ```
2.  The CLI will give you a URL to install the app on your development store.
3.  Once installed, you can access the admin interface from the **Apps** section of your Shopify Admin.
4.  To add the storefront calculator, go to **Online Store > Themes > Customize**.
5.  Navigate to the "Custom 3D Print" product page.
6.  In the theme editor sidebar, click **"Add block"** or **"Add section"** and find your app's embed block (e.g., "3D Print Calculator"). Place it where you want it to appear.
7.  Save your theme changes.

### Deployment

To make your app available for other stores, you need to deploy it.

1.  **Hosting**:
    - Choose a hosting provider for your web app (e.g., Vercel, Netlify, Heroku).
    - Deploy the frontend (React app) and backend (Node.js app) to your chosen provider.

2.  **Update Shopify App URLs**:
    - In your Shopify Partner Dashboard, go to your app's settings.
    - Update the App URL and Allowed Redirection URL(s) to point to your new production URLs.

3.  **Distribution**:
    - You can distribute your app via the Shopify App Store or as a custom app for a single client. Follow Shopify's official documentation for the submission and review process.

---

## 4. How to Use the App

### Store Owner (Admin)

1.  Navigate to the app from your Shopify Admin.
2.  You will land on the **Material Management** page.
3.  Here you can:
    - **Add a new material**: Click "Legg til nytt materiale", fill in the details (Name, Price/gram, Density, Base Fee), and save.
    - **Edit a material**: Click the "Rediger" (pencil) icon next to a material.
    - **Delete a material**: Click the "Slett" (trash) icon.
4.  These materials will instantly be available in the storefront calculator.

### Customer (Storefront)

1.  The customer visits the product page where you've added the App Embed block.
2.  They click to upload their `.STL` file.
3.  An interactive 3D preview appears.
4.  They select a material from the dropdown.
5.  The price is calculated and displayed instantly.
6.  They click "Legg i handlekurv". The file is "uploaded", the product is added to the cart with the custom price, and they are redirected to the cart page.
7.  In the final order, the store owner will see a line item property named `_3d_file_url` containing the link to the customer's file. The underscore `_` hides it from the customer by default on the cart and checkout pages.
